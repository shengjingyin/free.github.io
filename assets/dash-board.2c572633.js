import{l as q,s as A,d as V,x as U,f as g,a as h,o as m,n as C,c as j,y as te,u as l,F as J,v,w as S,g as B,z as oe,q as ne,A as P,t as ae,k as se,r as z,B as re,C as le,D as ce,p as ie,E as ue,G as de}from"./index.ee99680b.js";import{u as k}from"./lowcode.18c3e2e0.js";import{_ as X}from"./_plugin-vue_export-helper.cdc0426e.js";import{e as $}from"./index.da5474a2.js";const w=k(),ke=t=>new Promise(e=>setTimeout(e,t)),pe=(t,e=50)=>q.exports.throttle(t,e);function Y(t){return w.idMap.hasOwnProperty(t)?w.idMap[t]+1:1}function W(t,e){w.idMap[t]=e,++w.idMap.total,A.set("idMap",JSON.stringify(w.idMap))}const me={key:1,class:"bind-model"},ye=V({__name:"comp-wrap",props:{parent:{type:Object,required:!0},element:{type:Object,required:!0},index:{type:Number,required:!0}},setup(t){const e=t,{select:E,idMap:M}=U(k()),{SET_CUR_SELECT:D}=k(),y=g(()=>E.value.model==e.element.model),R=n=>{D(n.i)},I=()=>{const n=q.exports.cloneDeep(e.element),i=Y(n.component);n.model=n.component+`_${i}`,n.i=String(M.value.total+1),n.x=n.x,n.y=n.y+n.h,e.parent.children.push(n),W(n.component,i)},F=()=>{e.parent.children.splice(e.index,1),D("0")};return(n,i)=>{var c,_;const a=h("CopyDocument"),b=h("el-icon"),r=h("Delete");return m(),C("div",{onClick:i[0]||(i[0]=B(N=>R(t.element),["stop"])),class:P(["item-container",l(y)?"active":""])},[(m(),j(te(t.element.component),{element:t.element},null,8,["element"])),l(y)?(m(),C(J,{key:0},[v(b,{class:"copy tool",title:"\u590D\u5236",size:16,onClick:B(I,["stop"])},{default:S(()=>[v(a)]),_:1},8,["onClick"]),v(b,{class:"delete tool",title:"\u5220\u9664",size:16,onClick:B(F,["stop"])},{default:S(()=>[v(r)]),_:1},8,["onClick"])],64)):oe("",!0),ne("div",{class:P(["drag-able",l(y)?"active":""])},null,2),((c=t.element)!=null&&c.options.dataBind,m(),C("span",me,ae((_=t.element)==null?void 0:_.model),1))],2)}}});const _e=X(ye,[["__scopeId","data-v-f2c71414"]]),fe=t=>{A.set("data",JSON.stringify(t))},ge=["onClick"],ve=V({__name:"dash-board",props:{layoutData:{type:Array,required:!0},parent:{type:Object,required:!0}},setup(t){const e=t,{SET_CUR_SELECT:E}=k(),{data:M,idMap:D,selectId:y}=U(k()),R=()=>{E("0")},I=g(()=>e.parent.options.col),F=g(()=>e.parent.options["row-height"]),n=g(()=>e.parent.options["card-margin"]),i=g(()=>e.parent.style),a=g({get(){return e.layoutData},set(o){}}),b=q.exports.debounce((...o)=>{console.log("\u{1F680} ~ \u66F4\u65B0\u6570\u636E",...o),fe.apply(null,o)},1e3);se(M,o=>{b(o)},{deep:!0});const r={x:0,y:0};let c={x:0,y:0,w:1,h:1,i:""};const _=z(),N=z();let u;re(()=>{$.on("add-component",K),$.on("end-add-component",Q),document.addEventListener("dragover",G,!1)});const G=function(o){r.x=o.clientX,r.y=o.clientY};le(()=>{document.removeEventListener("dragover",G)});const T=z(),L=()=>T.value?(u=T.value.getBoundingClientRect(),r.x>u.left&&r.x<u.right&&r.y>u.top&&r.y<u.bottom&&e.parent.hasOwnProperty("children")&&y.value===e.parent.i):!1;let d;const H=pe(()=>{console.log("\u5E03\u5C40\u5C5E\u6027",`\u5BB9\u5668\uFF1A${e.parent.i} \u5F53\u524D\u9009\u4E2D\uFF1A${y.value}----`+JSON.stringify(a.value))}),K=async o=>{const p=L();d=Z(o);let f=a.value.findIndex(x=>x.i===d.i);if(p){debugger;if(f===-1)a.value.push({...d,x:a.value.length*2%12,y:a.value.length+12});else{await ce();try{const x=N.value[f];H();let s=x.calcXY(r.y-u.top,r.x-u.left);p&&(_.value.dragEvent("dragstart",d.i,s.x,s.y,1,1),c.i=d.i,c.x=a.value[f].x,c.y=a.value[f].y)}catch{}}}};let O;const Q=()=>{const o=L();try{_.value.dragEvent("dragend",c.i,c.x,c.y,1,1),o?W(d.component,O):a.value=a.value.filter(p=>p.i!==d.i)}catch{}},Z=o=>(O=Y(o.component),{...o,options:{...o.options},i:String(D.value.total+1),model:o.component+"_"+O});return(o,p)=>{const f=h("grid-item"),x=h("grid-layout");return m(),C("section",{ref_key:"dashBoardRef",ref:T,class:"size-100",style:de(l(i)),onClick:B(R,["stop"])},[v(x,{ref_key:"layoutRef",ref:_,class:"grid-layout",margin:[l(n),l(n)],layout:l(a),"onUpdate:layout":p[0]||(p[0]=s=>ue(a)?a.value=s:null),"col-num":l(I),"row-height":l(F),"is-draggable":!0,"is-resizable":!0,"vertical-compact":!1,"use-css-transforms":!0},{default:S(()=>[(m(!0),C(J,null,ie(l(a),(s,ee)=>(m(),j(f,{ref_for:!0,ref_key:"gridItemRef",ref:N,dragAllowFrom:".drag-able",key:s.i,x:s.x,y:s.y,w:s.w,h:s.h,i:s.i},{default:S(()=>[v(_e,{element:s,parent:t.parent,index:ee},null,8,["element","parent","index"])]),_:2},1032,["x","y","w","h","i"]))),128))]),_:1},8,["margin","layout","col-num","row-height"])],12,ge)}}});const Ee=X(ve,[["__scopeId","data-v-c3cffa6a"]]);export{Ee as d,ke as s};
