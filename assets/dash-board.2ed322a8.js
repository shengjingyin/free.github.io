import{l as P,s as V,d as U,x as J,f,a as w,o as p,n as k,c as X,y as oe,u as r,F as Y,v as g,w as R,g as M,z as ne,q as ae,A as $,t as se,k as re,r as O,B as le,C as ce,D as ie,p as ue,E as de,G as pe}from"./index.a4fd1c5c.js";import{u as D,a as q}from"./lowcode.ab889ec6.js";import{_ as j}from"./_plugin-vue_export-helper.cdc0426e.js";import{e as A}from"./index.da5474a2.js";const E=D(),Ee=o=>new Promise(t=>setTimeout(t,o)),me=(o,t=50)=>P.exports.throttle(o,t);function W(o){return E.idMap.hasOwnProperty(o)?E.idMap[o]+1:1}function H(o,t){E.idMap[o]=t,++E.idMap.total,V.set("idMap",JSON.stringify(E.idMap))}const ye={key:1,class:"bind-model"},_e=U({__name:"comp-wrap",props:{element:{type:Object,required:!0},index:{type:Number,required:!0}},setup(o){const t=o,{select:b,data:B,idMap:I}=J(D()),{SET_CUR_SELECT:v}=D(),x=f(()=>b.value.model==t.element.model),F=i=>{v(i.i)},N=()=>{const i=q(B.value,t.element),e=P.exports.cloneDeep(t.element),m=W(e.component);e.model=e.component+`_${m}`,e.i=String(I.value.total),e.x=e.x,e.y=e.y+e.h,i.children.push(e),H(e.component,m)},S=()=>{q(B.value,t.element).children.splice(t.index,1),v("0")};return(i,e)=>{var y,h;const m=w("CopyDocument"),s=w("el-icon"),l=w("Delete");return p(),k("div",{onClick:e[0]||(e[0]=M(c=>F(o.element),["stop"])),class:$(["item-container",r(x)?"active":""])},[(p(),X(oe(o.element.component),{element:o.element},null,8,["element"])),r(x)?(p(),k(Y,{key:0},[g(s,{class:"copy tool",title:"\u590D\u5236",size:16,onClick:M(N,["stop"])},{default:R(()=>[g(m)]),_:1},8,["onClick"]),g(s,{class:"delete tool",title:"\u5220\u9664",size:16,onClick:M(S,["stop"])},{default:R(()=>[g(l)]),_:1},8,["onClick"])],64)):ne("",!0),ae("div",{class:$(["drag-able",r(x)?"active":""])},null,2),((y=o.element)!=null&&y.options.dataBind,p(),k("span",ye,se((h=o.element)==null?void 0:h.model),1))],2)}}});const fe=j(_e,[["__scopeId","data-v-306b9df4"]]),ge=o=>{V.set("data",JSON.stringify(o))},ve=["onClick"],xe=U({__name:"dash-board",props:{layoutData:{type:Array,required:!0},parent:{type:Object,required:!0}},setup(o){const t=o,{SET_CUR_SELECT:b}=D(),{data:B,idMap:I,selectId:v}=J(D()),x=()=>{b("0")},F=f(()=>t.parent.options.col),N=f(()=>t.parent.options["row-height"]),S=f(()=>t.parent.options["card-margin"]),i=f(()=>t.parent.style),e=f({get(){return t.layoutData},set(n){}}),m=P.exports.debounce((...n)=>{console.log("\u{1F680} ~ \u66F4\u65B0\u6570\u636E",...n),ge.apply(null,n)},1e3);re(B,n=>{m(n)},{deep:!0});const s={x:0,y:0};let l={x:0,y:0,w:1,h:1,i:""};const y=O(),h=O();let c;le(()=>{A.on("add-component",Q),A.on("end-add-component",Z),document.addEventListener("dragover",G,!1)});const G=function(n){s.x=n.clientX,s.y=n.clientY};ce(()=>{document.removeEventListener("dragover",G)});const T=O(),L=()=>T.value?(c=T.value.getBoundingClientRect(),s.x>c.left&&s.x<c.right&&s.y>c.top&&s.y<c.bottom&&t.parent.hasOwnProperty("children")&&v.value===t.parent.i):!1;let u;const K=me(()=>{console.log("\u5E03\u5C40\u5C5E\u6027",`\u5BB9\u5668\uFF1A${t.parent.i} \u5F53\u524D\u9009\u4E2D\uFF1A${v.value}----`+JSON.stringify(e.value))}),Q=async n=>{const d=L();u=ee(n);let _=e.value.findIndex(C=>C.i===u.i);if(d){debugger;if(_===-1)e.value.push({...u,x:e.value.length*2%12,y:e.value.length+12});else{await ie();try{const C=h.value[_];K();let a=C.calcXY(s.y-c.top,s.x-c.left);d&&(y.value.dragEvent("dragstart",u.i,a.x,a.y,1,1),l.i=u.i,l.x=e.value[_].x,l.y=e.value[_].y)}catch{}}}};let z;const Z=()=>{const n=L();try{y.value.dragEvent("dragend",l.i,l.x,l.y,1,1),n?H(u.component,z):e.value=e.value.filter(d=>d.i!==u.i)}catch{}},ee=n=>(z=W(n.component),{...n,options:{...n.options},i:String(I.value.total+1),model:n.component+"_"+z});return(n,d)=>{const _=w("grid-item"),C=w("grid-layout");return p(),k("section",{ref_key:"dashBoardRef",ref:T,class:"size-100",style:pe(r(i)),onClick:M(x,["stop"])},[g(C,{ref_key:"layoutRef",ref:y,class:"grid-layout",margin:[r(S),r(S)],layout:r(e),"onUpdate:layout":d[0]||(d[0]=a=>de(e)?e.value=a:null),"col-num":r(F),"row-height":r(N),"is-draggable":!0,"is-resizable":!0,"vertical-compact":!1,"use-css-transforms":!0},{default:R(()=>[(p(!0),k(Y,null,ue(r(e),(a,te)=>(p(),X(_,{ref_for:!0,ref_key:"gridItemRef",ref:h,dragAllowFrom:".drag-able",key:a.i,x:a.x,y:a.y,w:a.w,h:a.h,i:a.i},{default:R(()=>[g(fe,{element:a,index:te},null,8,["element","index"])]),_:2},1032,["x","y","w","h","i"]))),128))]),_:1},8,["margin","layout","col-num","row-height"])],12,ve)}}});const De=j(xe,[["__scopeId","data-v-c031d787"]]);export{De as d,Ee as s};
